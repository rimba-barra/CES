Ext.define("Cashier.controller.Cashaging",{extend:"Cashier.library.template.controller.Controllermodule",alias:"controller.Cashaging",requires:["Cashier.template.ComboBoxFields","Cashier.library.template.combobox.Ptusercombobox","Cashier.library.template.combobox.Groupcombobox","Cashier.library.template.combobox.Departmentcombobox","Cashier.library.template.combobox.Loanercombobox","Cashier.library.template.combobox.Prefixcombobox",],views:["cashaging.Panel","cashaging.FormData"],stores:["Ptbyuser","Grouptransaction","Loaner","Prefixcombo",],models:[],refs:[{ref:"formdata",selector:"cashagingformdata"},{ref:"paneldata",selector:"cashagingpanel"}],controllerName:"cashaging",fieldName:"",bindPrefixName:"Cashaging",urlprocess:"cashier/cashaging/create",stimulsoft:"resources/stimulsoft/index.php?stimulsoft_client_key=ViewerFx&stimulsoft_report_key=",yeardata:null,paramsStr:null,win:null,params:null,dateNow:new Date(),html:null,winId:"myReportWindow",project_name:null,pt_name:null,userprint:null,urlrequest:null,senddata:null,info:null,form:null,cluster:null,value:null,statusdetail:null,statusdetaildesc:null,periode:null,filtercoa:null,fromcoa:null,untilcoa:null,fromdate:null,untildate:null,init:function(a){var b=this;this.control({cashagingpanel:{beforerender:b.mainPanelBeforeRender,afterrender:function(c){Ext.get("WINDOW-mnu"+b.bindPrefixName).setHeight(430);Ext.get("WINDOW-mnu"+b.bindPrefixName).setWidth(700);b.panelAfterRender()}},cashagingformdata:{afterrender:function(c){this.formDataAfterRenderCustome()}},"cashagingformdata button[action=submit]":{click:function(){this.showReport()}}})},arrayData:function(){var a;a=this;a.value=a.form.getValues();a.value.project_name=a.project_name;a.value.pt_name=a.pt_name;a.value.userprint=a.userprint;a.value.tgl_sekarang=a.dateNow.getDate()+"-"+(a.dateNow.getMonth()+1)+"-"+a.dateNow.getFullYear();a.value.time_sekarang=a.dateNow.getHours()+":"+a.dateNow.getMinutes()+":"+a.dateNow.getSeconds();a.value.project_id=apps.project;a.value.pt_id=apps.pt;a.value.statusdetaildesc=a.statusdetaildesc;a.value.statusdetail=a.statusdetail;a.value.periode=a.periode;a.value.filtercoa=a.filtercoa;a.value.cluster=a.cluster},createWindows:function(){var a=this;a.instantWindow("Panel",800,"Result ","state-report",a.winId,"masterreport");a.paramsStr=a.generateReportParams(a.getFormdata().getForm().getFieldValues());a.win=desktop.getWindow(a.winId)},submitReport:function(){var a=this;a.report="Cashaging";a.html=a.generateFakeForm(a.value,a.report);a.win.down("#MyReportPanel").body.setHTML(a.html);$("#fakeReportFormID").submit()},showReport:function(){var a;a=this;a.form=a.getFormdata().getForm();a.generateReport()},setupData:function(){var a;a=this;a.statusdetail=a.getValueRadio(a,"#radiodetail1");a.fromcoa=a.getValueCombobox(a,"fromcoa");a.untilcoa=a.getValueCombobox(a,"untilcoa");a.fromdate=a.getValueCombobox(a,"fromdate");a.untildate=a.getValueCombobox(a,"untildate");if(a.statusdetail==true){a.statusdetaildesc="With Detail"}else{a.statusdetaildesc="Without Detail"}a.periode=a.fromdate.value+" to "+a.untildate.value;a.filtercoa=a.fromcoa.value+" to "+a.untilcoa.value;var b={statusdetail:a.statusdetail,fromcoa:a.fromcoa.value,untilcoa:a.untilcoa.value,fromdate:a.fromdate.value,untildate:a.untildate.value,};a.arraydata=b},generateReport:function(){var a;a=this;resetTimer();a.setupData();a.arraydata.hideparam="generatereport";a.senddata=a.arraydata;a.urlrequest=a.urlprocess;Ext.getBody().mask("Please wait...");a.AjaxRequest()},formDataAfterRenderCustome:function(){var b,c,a="";b=this;a=b.getFormdata();b.setStoreFormdata()},AjaxRequest:function(){var a;a=this;Ext.Ajax.request({url:a.urlrequest,method:"POST",params:{data:Ext.encode(a.senddata)},success:function(b){a.info=Ext.JSON.decode(b.responseText);a.setSuccessEvent()},failure:function(b){a.getFormdata().up("window").close()}})},setSuccessEvent:function(){var b=this;if(b.info.parameter=="default"){if(b.info.counter<1){Ext.getBody().unmask();b.buildWarningAlert(b.info.message)}else{Ext.getBody().unmask();Ext.Msg.show({title:"Success",msg:"Process  data successfully.",icon:Ext.Msg.INFO,buttons:Ext.Msg.OK,fn:function(){b.formDataClose()}})}}else{if(b.info.parameter=="defaultrange"){var a=b.getFormdata();b.yeardata=b.info.data.yeardb;a.down("[name=fromdate]").setValue(b.info.data.onedate);a.down("[name=untildate]").setValue(b.info.data.onedate);a.down("[name=fromdate]").setMinValue(b.yeardata+"-01-01");a.down("[name=fromdate]").setMaxValue(b.info.data.enddecember);a.down("[name=untildate]").setMinValue(b.yeardata+"-01-01");a.down("[name=untildate]").setMaxValue(b.info.data.enddecember)}else{if(b.info.parameter=="default"){Ext.getBody().unmask()}else{if(b.info.parameter=="generatereport"){var a=b.getFormdata();Ext.getBody().unmask();b.cluster=b.info.data.cluster;b.createWindows();b.arrayData();b.submitReport()}}}}},panelAfterRender:function(){var a=this;Ext.Ajax.request({url:"cashier/cashaging/read",success:function(b){var c=Ext.JSON.decode(b.responseText);a.project_name=c.project_name;a.pt_name=c.pt_name;a.userprint=c.userprint},})},});